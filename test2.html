<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Recorder</title>
</head>
<body>
    <h1>Audio Recorder</h1>
    <button id="start">Start Recording</button>
    <button id="stop" disabled>Stop Recording</button>
    <button id="play" disabled>Play Recording</button>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let audioContext;
        let audioBuffer;

        async function setupAudio() {
            // Request microphone access
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

            // Create audio context
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const source = audioContext.createMediaStreamSource(stream);

            console.log("MediaStreamSource created:", source);

            // Use MediaRecorder for recording
            mediaRecorder = new MediaRecorder(stream);

            // Collect audio data chunks
            mediaRecorder.ondataavailable = (event) => {
                audioChunks.push(event.data);
            };

            // Handle recording stop
            mediaRecorder.onstop = async () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const arrayBuffer = await audioBlob.arrayBuffer();
                audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

                console.log("Audio data decoded.");
                audioChunks = []; // Reset chunks for the next recording
                document.getElementById("play").disabled = false; // Enable play button
            };
        }

        // Start recording
        document.getElementById("start").onclick = () => {
            if (mediaRecorder) {
                mediaRecorder.start();
                console.log("Recording started");
                document.getElementById("start").disabled = true;
                document.getElementById("stop").disabled = false;
            }
        };

        // Stop recording
        document.getElementById("stop").onclick = () => {
            if (mediaRecorder) {
                mediaRecorder.stop();
                console.log("Recording stopped");
                document.getElementById("start").disabled = false;
                document.getElementById("stop").disabled = true;
            }
        };

        // Play recording
        document.getElementById("play").onclick = () => {
            if (audioBuffer) {
                const source = audioContext.createBufferSource();
                source.buffer = audioBuffer;
                source.connect(audioContext.destination);
                source.start();
                console.log("Playing recording...");
            } else {
                console.error("No audio data to play.");
            }
        };

        // Initialize the audio setup
        setupAudio().catch((error) => {
            console.error("Error setting up audio:", error);
        });
    </script>
</body>
</html>

